<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lexlet Library</title>

  <style>
    :root{
  --bg: #ECE6D9;
  --paper: #EEE6DC;
  --text: #1A1A1A;
  --muted: rgba(26,26,26,.55);
  --border: rgba(26,26,26,.12);
  --accent: #D26759;
  --panel: #F4EFE6; /* светлее, чем --paper */
      
  --radius: 14px;
  --max: 760px;

  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
               "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

*{ box-sizing:border-box; }

body{
  margin:0;
  background: var(--bg);
  color: var(--text);
}

.wrap{
  max-width: var(--max);
  margin: 0 auto;
  padding: 20px 16px 40px;
}

/* language */
.langbar{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom: 16px;
}
.langbtn{
  border:none;
  background: transparent;
  color: var(--muted);
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 13px;
  cursor:pointer;
}
.langbtn.active{
  color: var(--text);
  background: rgba(210,103,89,.12);
}

/* header */
.header{
  display:flex;
  gap:14px;
  align-items:center;
  padding: 18px;
  background: var(--paper);
  border-radius: var(--radius);
}

.icon{
  width:48px;
  height:48px;
  border-radius:12px;
  object-fit:cover;
}

h1{
  margin:0;
  font-size:18px;
  font-weight:600;
}

.subtitle{
  margin:6px 0 0;
  font-size:14px;
  color: var(--muted);
  line-height:1.4;
}

/* search */
.search{
  margin-top:16px;
  padding:16px;
  background: var(--panel);
  border: 1px solid rgba(26,26,26,.10);
  border-radius: var(--radius);
}
.search input{
  width:100%;
  border:none;
  outline:none;
  background: transparent;
  color: var(--text);
  font-size:14px;
}

.search input::placeholder{
  color: var(--muted);
}

/* list */
.list{
  margin-top:16px;
  display:flex;
  flex-direction:column;
  gap:14px;              /* больше воздуха между блоками */
}

.item{
  padding:16px;
  background: var(--panel);     /* важный момент */
  border: 1px solid rgba(26,26,26,.10);
  border-radius: var(--radius);
}
    /* тонкий разделитель между заголовком и описанием */
.divider{
  height:1px;
  background: rgba(26,26,26,.08);
  margin: 12px 0;
}
    
.itemTop{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 12px;
}
    
.title{
  margin:0;
  font-size:15px;
  font-weight:500;
}

.level{
  font-size:12px;
  color: var(--muted);
  margin-right:8px;
}

.descRow{
  display:grid;
  grid-template-columns: 1fr auto;
  gap: 14px;
  align-items:start;
}

.desc{
  margin:0;
  font-size:14px;
  color: var(--muted);
  line-height:1.4;
  flex:1;
}

.btn{
  border:none;
  background: var(--accent);
  color:white;
  padding:8px 14px;
  border-radius:10px;
  font-size:13px;
  cursor:pointer;
  transition: opacity .15s ease;
}
.btn:hover{
  opacity:.85;
}

.meta{
  margin-top: 12px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  font-size:12px;
  color: var(--muted);
}

.meta span{
  background: rgba(26,26,26,.05);
  border: 1px solid rgba(26,26,26,.06);
  padding:4px 8px;
  border-radius:999px;
}

.empty{
  margin-top:16px;
  font-size:14px;
  color: var(--muted);
}
  </style>
</head>

<body>
  <div class="wrap">

    <!-- 1) language first -->
    <div class="langbar" aria-label="Language">
      <button class="langbtn active" data-locale="ru">Русский</button>
      <button class="langbtn" data-locale="fr">Français</button>
      <button class="langbtn" data-locale="es">Español</button>
      <button class="langbtn" data-locale="zh">中文</button>
      <button class="langbtn" data-locale="de">Deutsch</button>
    </div>

    <!-- 2) header with icon + title + short description -->
    <div class="header">
      <img class="icon" src="assets/lexlet_app.png" alt="Lexlet icon" onerror="this.style.display='none';" />
      <div>
        <h1>Lexlet Library</h1>
        <p class="subtitle">Готовые наборы карточек для изучения английского. Выбирай уровень и тему — скачивай и добавляй в приложение.</p>
      </div>
    </div>

    <!-- 3) search -->
    <div class="search">
      <input id="q" type="search" placeholder="Поиск по названию или теме" autocomplete="off" />
    </div>

    <!-- 4) packs -->
    <div id="list" class="list" hidden></div>
    <div id="empty" class="empty" hidden>Ничего не найдено.</div>

  </div>

<script>
(() => {
  const INDEX_URL = "index.json";

  const elList = document.getElementById("list");
  const elEmpty = document.getElementById("empty");
  const elQ = document.getElementById("q");
  const elLangBtns = [...document.querySelectorAll(".langbtn")];

  // Если хочешь — можно сделать эти элементы id-шниками и менять тексты точечно.
  // Сейчас меняем subtitle через поиск .subtitle в шапке.
  const elSubtitle = document.querySelector(".subtitle");
  const elFooter = document.querySelector("footer");

  const I18N = {
    ru: {
      subtitle: "Готовые наборы карточек для изучения английского. Выбирай уровень и тему — скачивай и добавляй в приложение.",
      searchPlaceholder: "Поиск по названию или теме",
      download: "Скачать",
      empty: "Ничего не найдено.",
      footer: "Идеи и баги — через Issues в репозитории.",
      words: "слов"
    },
    fr: {
      subtitle: "Packs prêts pour apprendre l’anglais. Choisis un niveau et un thème — télécharge et ajoute dans l’app.",
      searchPlaceholder: "Recherche par titre ou thème",
      download: "Télécharger",
      empty: "Aucun résultat.",
      footer: "Idées et bugs — via Issues du dépôt.",
      words: "mots"
    },
    es: {
      subtitle: "Packs listos para aprender inglés. Elige nivel y tema — descarga y añade a la app.",
      searchPlaceholder: "Buscar por nombre o tema",
      download: "Descargar",
      empty: "No se encontró nada.",
      footer: "Ideas y bugs — en Issues del repositorio.",
      words: "palabras"
    },
    zh: {
      subtitle: "用于学习英语的现成卡组。选择等级和主题 — 下载并添加到应用中。",
      searchPlaceholder: "按名称或主题搜索",
      download: "下载",
      empty: "没有结果。",
      footer: "想法和问题 — 在仓库 Issues 里提。",
      words: "词"
    },
    de: {
      subtitle: "Fertige Sets zum Englischlernen. Wähle Level und Thema — herunterladen und in der App hinzufügen.",
      searchPlaceholder: "Suche nach Titel oder Thema",
      download: "Herunterladen",
      empty: "Keine Ergebnisse.",
      footer: "Ideen & Bugs — über Issues im Repository.",
      words: "Wörter"
    }
  };

  let index = null;
  let activeLocale = "ru";
  let packs = [];

  const norm = (s) => (s ?? "").toString().trim().toLowerCase();
  const esc = (s) => (s ?? "").toString()
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");

  function applyLocaleTexts(localeId){
    const t = I18N[localeId] || I18N.ru;
    if (elSubtitle) elSubtitle.textContent = t.subtitle;
    if (elFooter) elFooter.textContent = t.footer;
    elQ.placeholder = t.searchPlaceholder;
    // empty text will be set inside render(), but set baseline:
    elEmpty.textContent = t.empty;
  }

  function getLocalePacks(localeId){
    const loc = (index?.uiLocales || []).find(x => x.id === localeId);
    return (loc?.packs || []).map(p => ({
      id: p.id,
      title: p.title,
      level: p.level || "",
      topic: p.topic || "",
      words: Number.isFinite(p.words) ? p.words : null,
      description: p.description || "",
      url: p.csv?.url || p.url,
      tags: p.tags || []
    }));
  }

  function filterPacks(arr){
    const q = norm(elQ.value);
    if (!q) return arr;
    return arr.filter(x => {
      const hay = [x.title, x.topic, x.level].map(norm).join(" | ");
      return hay.includes(q);
    });
  }

  function render(){
    const t = I18N[activeLocale] || I18N.ru;

    packs = getLocalePacks(activeLocale);
    const shown = filterPacks(packs);

    if (!shown.length){
      elList.hidden = true;
      elEmpty.hidden = false;
      elEmpty.textContent = t.empty;
      return;
    }

    elEmpty.hidden = true;
    elList.hidden = false;

    elList.innerHTML = shown.map(p => `
      <div class="item">
        <div class="itemTop">
          <div class="titleRow">
            <h3 class="title">
              ${esc(p.title)}
            </h3>
          </div>
        </div>

        <div class="divider"></div>

        <div class="descRow">
          <p class="desc">${esc(p.description || "Card pack for English practice.")}</p>
          <a class="btn primary" href="${esc(p.url)}" download>${esc(t.download)}</a>
        </div>

        <div class="meta">
          <span>EN → ${esc(activeLocale.toUpperCase())}</span>
          ${p.level ? `<span class="level">${esc(p.level)}</span>` : ""}
          ${Number.isFinite(p.words) ? `<span>${esc(p.words)} ${esc(t.words)}</span>` : ""}
        </div>
      </div>
    `).join("");
  }

  function setLocale(localeId){
    activeLocale = localeId;
    elLangBtns.forEach(b => b.classList.toggle("active", b.dataset.locale === localeId));

    applyLocaleTexts(activeLocale);
    elQ.value = "";
    render();

    const url = new URL(window.location.href);
    url.searchParams.set("locale", localeId);
    history.replaceState(null, "", url.toString());
  }

  async function init(){
    try{
      const res = await fetch(INDEX_URL, { cache: "no-store" });
      index = await res.json();
      if (!index.uiLocales && index.languages) index.uiLocales = index.languages;

      const url = new URL(window.location.href);
      const fromUrl = url.searchParams.get("locale");
      if (fromUrl) activeLocale = fromUrl;

      elLangBtns.forEach(btn => btn.addEventListener("click", () => setLocale(btn.dataset.locale)));
      elQ.addEventListener("input", render);

      setLocale(activeLocale);
    } catch (e){
      elList.hidden = true;
      elEmpty.hidden = false;
      elEmpty.textContent = "Не получилось загрузить данные библиотеки.";
      console.error(e);
    }
  }

  init();
})();
</script>

</body>
</html>
